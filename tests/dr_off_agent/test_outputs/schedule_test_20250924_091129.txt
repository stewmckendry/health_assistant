================================================================================
   SCHEDULE.GET MCP TOOL TEST SUITE
   Testing OHIP Schedule of Benefits Lookup
   Output File: tests/dr_off_agent/test_outputs/schedule_test_20250924_091129.txt
================================================================================

🔧 ENVIRONMENT CHECK:
  Python: 3.11.8
  Working Dir: /Users/liammckendry/health_assistant_dr_off_worktree
  OPENAI_API_KEY: ✅ Set
  Output File: tests/dr_off_agent/test_outputs/schedule_test_20250924_091129.txt

--------------------------------------------------------------------------------

================================================================================
  Test 1.1: MRP Discharge Billing (C124)
================================================================================

📝 Test Description:
  Scenario: MRP billing on day of discharge after 72+ hour admission
  Expected: Should find C124 fee code with requirements and documentation
  Codes to check: C124, C122, C123

🚀 Executing query...
⏱️  Response time: 1.500 seconds

### MRP Discharge Billing
Timestamp: 2025-09-24T09:11:31.014606
Confidence Score: 0.600
Data Sources Used: ['sql']

📋 Found 0 items:

🔍 Raw Response JSON:
{
  "provenance": [
    "sql"
  ],
  "confidence": 0.6,
  "items": [],
  "citations": [],
  "conflicts": []
}

📊 Evaluation Results:
  Confidence: 0.600 (threshold: 0.7)
  Dual-path retrieval: SQL=True Vector=False
  Expected codes: ['C124']
  Found codes: []
  Data Quality Checks:
  ❌ No citations provided

❌ TEST FAILED
Issues found:
  - Low confidence: 0.600
  - Missing dual-path retrieval: ['sql']
  - Expected code C124 not found
  - No citations provided

--------------------------------------------------------------------------------

================================================================================
  Test 1.2: Emergency Department Consultation
================================================================================

📝 Test Description:
  Scenario: Internist consultation in emergency department
  Expected: Should find consultation codes with specialty restrictions
  Codes to check: A135, A935

🚀 Executing query...
⏱️  Response time: 0.799 seconds

### Emergency Consultation
Timestamp: 2025-09-24T09:11:32.815418
Confidence Score: 0.750
Data Sources Used: ['sql', 'vector']

📋 Found 0 items:

📚 Citations (1 sources):
  - Source: schedule.pdf
    Location: 
    Page: None

🔍 Raw Response JSON:
{
  "provenance": [
    "sql",
    "vector"
  ],
  "confidence": 0.75,
  "items": [],
  "citations": [
    {
      "source": "schedule.pdf",
      "loc": "",
      "page": null
    }
  ],
  "conflicts": []
}

📊 Evaluation Results:
  Confidence: 0.750 (threshold: 0.7)
  Dual-path retrieval: SQL=True Vector=True
  Expected codes: ['A135']
  Found codes: []
  Data Quality Checks:
  ✅ 1 citations provided

❌ TEST FAILED
Issues found:
  - Expected code A135 not found

--------------------------------------------------------------------------------

================================================================================
  Test 1.3: House Call with Premiums
================================================================================

📝 Test Description:
  Scenario: House call assessment for elderly patient with time premiums
  Expected: Should find house call codes with premium information
  Codes to check: B998, B992, B994

🚀 Executing query...
⏱️  Response time: 0.885 seconds

### House Call Premiums
Timestamp: 2025-09-24T09:11:34.701392
Confidence Score: 0.750
Data Sources Used: ['sql', 'vector']

📋 Found 0 items:

📚 Citations (1 sources):
  - Source: schedule.pdf
    Location: 
    Page: None

🔍 Raw Response JSON:
{
  "provenance": [
    "sql",
    "vector"
  ],
  "confidence": 0.75,
  "items": [],
  "citations": [
    {
      "source": "schedule.pdf",
      "loc": "",
      "page": null
    }
  ],
  "conflicts": []
}

📊 Evaluation Results:
  Confidence: 0.750 (threshold: 0.7)
  Dual-path retrieval: SQL=True Vector=True
  Expected codes: []
  Found codes: []
  Data Quality Checks:
  ✅ 1 citations provided

✅ TEST PASSED

================================================================================
   TEST SUMMARY
================================================================================

📊 Overall Results: 1/3 tests passed
📁 Full output saved to: tests/dr_off_agent/test_outputs/schedule_test_20250924_091129.txt

Test Status:
  ❌ FAIL - MRP Discharge
       - Low confidence: 0.600
       - Missing dual-path retrieval: ['sql']
       - Expected code C124 not found
  ❌ FAIL - Emergency Consultation
       - Expected code A135 not found
  ✅ PASS - House Call Premiums

⏱️  Performance Metrics:
  MRP Discharge:
    - Confidence: 0.600
    - Items: 0
    - Dual-path: False
  Emergency Consultation:
    - Confidence: 0.750
    - Items: 0
    - Dual-path: True
  House Call Premiums:
    - Confidence: 0.750
    - Items: 0
    - Dual-path: True

✅ Test output saved to: tests/dr_off_agent/test_outputs/schedule_test_20250924_091129.txt
